/*!
* Open Web Excel - ✍️ An Excel Used on the Browser Side.
* git+https://github.com/hai2007/Open-Web-Excel.git
*
* author 你好2007
*
* version 0.1.0-alpha.0
*
* Copyright (c) 2021 hai2007 走一步，再走一步。
* Released under the MIT license
*
* Date:Mon Apr 19 2021 17:53:49 GMT+0800 (GMT+08:00)
*/

"use strict";function _typeof(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function t(e){return typeof e}}else{_typeof=function t(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(t)}(function(){"use strict";var e=Object.prototype.toString;function n(t){if(t==null){return t===undefined?"[object Undefined]":"[object Null]"}return e.call(t)}function o(t){if(t===null||_typeof(t)!=="object"||n(t)!="[object Object]"){return false}if(Object.getPrototypeOf(t)===null){return true}var e=t;while(Object.getPrototypeOf(e)!==null){e=Object.getPrototypeOf(e)}return Object.getPrototypeOf(t)===e}var r=function t(e,n){return n!==null&&_typeof(n)==="object"&&e.indexOf(n.nodeType)>-1&&!o(n)};var i=function t(e){return r([1,9,11],e)};var s={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var p={stopPropagation:function t(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function t(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},isNode:function t(e){return e&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)},bind:function t(e,n,o){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var r=0;r<e.length;r++){this.bind(e[r],n,o)}return}if(window.attachEvent)e.attachEvent("on"+n,o);else e.addEventListener(n,o,false)},unbind:function t(e,n,o){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var r=0;r<e.length;r++){this.unbind(e[r],n,o)}return}if(window.detachEvent)e.detachEvent("on"+n,o);else e.removeEventListener(n,o,false)},find:function t(e,n,o){if(!this.isNode(e))return[];var r=e.getElementsByTagName(o||"*");var i=[];for(var s=0;s<r.length;s++){if(this.isNode(r[s])&&(typeof n!="function"||n(r[s])))i.push(r[s])}return i},children:function t(e,n){var o=e.childNodes;var r=[];for(var i=0;i<o.length;i++){if(this.isNode(o[i])&&(typeof n!="function"||n(o[i])))r.push(o[i])}return r},hasClass:function t(e,n,o){if(n.constructor!==Array)n=[n];var r=" "+(e.getAttribute("class")||"")+" ";for(var i=0;i<n.length;i++){if(r.indexOf(" "+n[i]+" ")>=0){if(o)return true}else{if(!o)return false}}return true},removeClass:function t(e,n){var o=" "+(e.getAttribute("class")||"")+" ";var r=o.replace(" "+n.trim()+" "," ");e.setAttribute("class",r.trim())},addClass:function t(e,n){if(this.hasClass(e,n))return;var o=e.getAttribute("class")||"";e.setAttribute("class",o+" "+n)},toNode:function t(e,n){var o;if(n)o=document.createElementNS(s.svg,"svg");else o=document.createElement("div");o.innerHTML=e;var r=o.childNodes;for(var i=0;i<r.length;i++){if(this.isNode(r[i]))return r[i]}},trigger:function t(e,n){if(document.createEventObject){e.fireEvent("on"+n,document.createEventObject())}else{var o=document.createEvent("HTMLEvents");o.initEvent(n,true,false);e.dispatchEvent(o)}},getStyle:function t(e,n){var o=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof n==="string"?o.getPropertyValue(n):o},offsetPosition:function t(e){var n=0;var o=0;o=e.offsetTop;n=e.offsetLeft;e=e.offsetParent;while(e){o+=e.offsetTop;n+=e.offsetLeft;e=e.offsetParent}return{left:n,top:o}},mousePosition:function t(e,n){var o=e.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");return{x:n.clientX-o.left,y:n.clientY-o.top}},remove:function t(e){e.parentNode.removeChild(e)},setStyles:function t(e,n){for(var o in n){e.style[o]=n[o]}},size:function t(e,n){var o,r;if(n=="content"){r=e.clientWidth-(this.getStyle(e,"padding-left")+"").replace("px","")-(this.getStyle(e,"padding-right")+"").replace("px","");o=e.clientHeight-(this.getStyle(e,"padding-top")+"").replace("px","")-(this.getStyle(e,"padding-bottom")+"").replace("px","")}else if(n=="padding"){r=e.clientWidth;o=e.clientHeight}else if(n=="border"){r=e.offsetWidth;o=e.offsetHeight}else if(n=="scroll"){r=e.scrollWidth;o=e.scrollHeight}else{r=e.offsetWidth;o=e.offsetHeight}return{width:r,height:o}},append:function t(e,n){var o=this.isNode(n)?n:this.toNode(n);e.appendChild(o);return o},prepend:function t(e,n){var o=this.isNode(n)?n:this.toNode(n);e.insertBefore(o,e.childNodes[0]);return o},after:function t(e,n){var o=this.isNode(n)?n:this.toNode(n);e.parentNode.insertBefore(o,e.nextSibling);return o},before:function t(e,n){var o=this.isNode(n)?n:this.toNode(n);e.parentNode.insertBefore(o,e);return o}};function t(){this._el.innerHTML="";p.setStyles(this._el,{"background-color":"#f7f7f7"})}function l(){var o=this;this._contentDom=[];var t=p.append(this._el,"<div></div>");p.setStyles(t,{width:"100%",height:"calc(100% - 92px)",overflow:"auto"});for(var e=0;e<this._contentArray.length;e++){var n="";n+="<tr><th style='width:50px;border: 1px solid #d6cccb;border-right:none;background-color:white;'></th>";for(var r=0;r<this._contentArray[e].content[0].length;r++){n+="<th style='border: 1px solid #d6cccb;border-bottom:none;color:gray;'>"+this.$$calcColName(r)+"</th>"}n+="</tr>";for(var i=0;i<this._contentArray[e].content.length;i++){n+="<tr><th style='width:50px;border: 1px solid #d6cccb;border-right:none;color:gray;'>"+(i+1)+"</th>";for(var s=0;s<this._contentArray[e].content[i].length;s++){if(this._contentArray[e].content[i][s]!="null"){n+='<th contenteditable="true" style="vertical-align:top;min-width:50px;padding:5px;white-space: nowrap;outline:0.5px solid #555555;background-color:white;" index="'+i+"-"+s+'" row-number="'+i+'" col-number="'+s+'" colspan="'+this._contentArray[e].content[i][s].colspan+'"  rowspan="'+this._contentArray[e].content[i][s].rowspan+'">'+this._contentArray[e].content[i][s].value+"</th>"}}n+="</tr>"}this._contentDom[e]=p.append(t,"<table>"+n+"</table>");p.setStyles(this._contentDom[e],{"border-collapse":"collapse",width:"100%",display:e==0?"table":"none"})}var l=p.append(this._el,"<div></div>");p.setStyles(l,{width:"100%",height:"30px",overflow:"auto","border-top":"1px solid #d6cccb","box-sizing":"border-box"});var a=p.append(l,"<span>+</span>");p.setStyles(a,{"line-height":"30px",width:"30px","text-align":"center","font-size":"18px","box-sizing":"border-box","vertical-align":"top",display:"inline-block",cursor:"pointer"});p.bind(a,"click",function(){});this._btnDom=[];var c=function t(e){var n=p.append(l,"<span>"+o._contentArray[e].name+"</span>");p.setStyles(n,{"line-height":"30px","font-size":"12px","box-sizing":"border-box",padding:"0 10px","vertical-align":"top",display:"inline-block",cursor:"pointer"});p.bind(n,"click",function(){for(var t=0;t<o._contentDom.length;t++){if(t==e){p.setStyles(o._contentDom[t],{display:"table"});p.setStyles(o._btnDom[t],{"background-color":"white"})}else{p.setStyles(o._contentDom[t],{display:"none"});p.setStyles(o._btnDom[t],{"background-color":"transparent"})}}});o._btnDom.push(n)};for(var f=0;f<this._contentArray.length;f++){c(f)}this._btnDom[0].click()}function a(t){if(t&&"version"in t&&t.filename=="Open-Web-Excel"){return t.contents}else{var e=[];for(var n=0;n<100;n++){var o=[];for(var r=0;r<30;r++){o.push({value:"",colspan:"1",rowspan:"1"})}e.push(o)}return[{name:"未命名",content:e}]}}function c(t){var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var n="";while(true){var o=t%26;n=e[o]+n;t=Math.floor(t/26);if(t==0)break;t-=1}return n}function f(){var t=p.append(this._el,"<div></div>");p.setStyles(t,{width:"100%",height:"62px",overflow:"auto"});this._menuDom=p.append(t,"<div>\n        <span>编辑</span>\n        <span>插入</span>\n        <span>格式</span>\n        <span>公式</span>\n        <span>数据</span>\n        <span>帮助</span>\n    </div>");p.setStyles(this._menuDom,{"border-bottom":"1px solid #d6cccb",padding:"0 20px","box-sizing":"border-box"});var e=p.find(this._menuDom,function(){return true},"span");for(var n=0;n<e.length;n++){p.setStyles(e[n],{display:"inline-block","line-height":"26px",padding:"0 10px","font-size":"12px",cursor:"pointer",color:"#555555"})}}var d=function t(e){var n=this;if(!(this instanceof t)){throw new Error("Open-Web-Excel is a constructor and should be called with the `new` keyword")}if(i(e.el)){this._el=e.el;this._contentArray=this.$$formatContent(e.content)}else{throw new Error("options.el is not a element!")}this.$$initDom();this.$$createdMenu();this.$$initView();this.valueOf=function(){return{version:"0.1.0",filename:"Open-Web-Excel",contents:n._contentArray}}};d.prototype.$$formatContent=a;d.prototype.$$calcColName=c;d.prototype.$$initDom=t;d.prototype.$$initView=l;d.prototype.$$createdMenu=f;if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=d}else{window.OpenWebExcel=d}})();