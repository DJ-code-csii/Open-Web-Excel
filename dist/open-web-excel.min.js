/*!
* Open Web Excel - ✍️ An Excel Used on the Browser Side.
* git+https://github.com/hai2007/Open-Web-Excel.git
*
* author 你好2007
*
* version 0.2.0-beta.0
*
* Copyright (c) 2021 hai2007 走一步，再走一步。
* Released under the MIT license
*
* Date:Wed Apr 28 2021 13:15:12 GMT+0800 (GMT+08:00)
*/

"use strict";function _typeof(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function e(t){return typeof t}}else{_typeof=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof(e)}(function(){"use strict";var t=Object.prototype.toString;function n(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function e(e){return typeof e==="number"||e!==null&&_typeof(e)==="object"&&n(e)==="[object Number]"}function o(e){if(e===null||_typeof(e)!=="object"||n(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}var r=function e(t,n){return n!==null&&_typeof(n)==="object"&&t.indexOf(n.nodeType)>-1&&!o(n)};var i=e;var s=function e(t){return r([1,9,11],t)};var a={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var b={stopPropagation:function e(t){t=t||window.event;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},preventDefault:function e(t){t=t||window.event;if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},isNode:function e(t){return t&&(t.nodeType===1||t.nodeType===9||t.nodeType===11)},bind:function e(t,n,o){if(t.constructor===Array||t.constructor===NodeList||t.constructor===HTMLCollection){for(var r=0;r<t.length;r++){this.bind(t[r],n,o)}return}if(window.attachEvent)t.attachEvent("on"+n,o);else t.addEventListener(n,o,false)},unbind:function e(t,n,o){if(t.constructor===Array||t.constructor===NodeList||t.constructor===HTMLCollection){for(var r=0;r<t.length;r++){this.unbind(t[r],n,o)}return}if(window.detachEvent)t.detachEvent("on"+n,o);else t.removeEventListener(n,o,false)},find:function e(t,n,o){if(!this.isNode(t))return[];var r=t.getElementsByTagName(o||"*");var i=[];for(var s=0;s<r.length;s++){if(this.isNode(r[s])&&(typeof n!="function"||n(r[s])))i.push(r[s])}return i},children:function e(t,n){var o=t.childNodes;var r=[];for(var i=0;i<o.length;i++){if(this.isNode(o[i])&&(typeof n!="function"||n(o[i])))r.push(o[i])}return r},hasClass:function e(t,n,o){if(n.constructor!==Array)n=[n];var r=" "+(t.getAttribute("class")||"")+" ";for(var i=0;i<n.length;i++){if(r.indexOf(" "+n[i]+" ")>=0){if(o)return true}else{if(!o)return false}}return true},removeClass:function e(t,n){var o=" "+(t.getAttribute("class")||"")+" ";var r=o.replace(" "+n.trim()+" "," ");t.setAttribute("class",r.trim())},addClass:function e(t,n){if(this.hasClass(t,n))return;var o=t.getAttribute("class")||"";t.setAttribute("class",o+" "+n)},toNode:function e(t,n){var o;if(n)o=document.createElementNS(a.svg,"svg");else{var r="div";if(/^<tr[> ]/.test(t)){r="tbody"}else if(/^<th[> ]/.test(t)||/^<td[> ]/.test(t)){r="tr"}else if(/^<thead[> ]/.test(t)||/^<tbody[> ]/.test(t)){r="table"}o=document.createElement(r)}o.innerHTML=t;var i=o.childNodes;for(var s=0;s<i.length;s++){if(this.isNode(i[s]))return i[s]}},trigger:function e(t,n){if(document.createEventObject){t.fireEvent("on"+n,document.createEventObject())}else{var o=document.createEvent("HTMLEvents");o.initEvent(n,true,false);t.dispatchEvent(o)}},getStyle:function e(t,n){var o=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle;return typeof n==="string"?o.getPropertyValue(n):o},offsetPosition:function e(t){var n=0;var o=0;o=t.offsetTop;n=t.offsetLeft;t=t.offsetParent;while(t){o+=t.offsetTop;n+=t.offsetLeft;t=t.offsetParent}return{left:n,top:o}},mousePosition:function e(t,n){var o=t.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");return{x:n.clientX-o.left,y:n.clientY-o.top}},remove:function e(t){t.parentNode.removeChild(t)},setStyles:function e(t,n){for(var o in n){t.style[o]=n[o]}},size:function e(t,n){var o,r;if(n=="content"){r=t.clientWidth-(this.getStyle(t,"padding-left")+"").replace("px","")-(this.getStyle(t,"padding-right")+"").replace("px","");o=t.clientHeight-(this.getStyle(t,"padding-top")+"").replace("px","")-(this.getStyle(t,"padding-bottom")+"").replace("px","")}else if(n=="padding"){r=t.clientWidth;o=t.clientHeight}else if(n=="border"){r=t.offsetWidth;o=t.offsetHeight}else if(n=="scroll"){r=t.scrollWidth;o=t.scrollHeight}else{r=t.offsetWidth;o=t.offsetHeight}return{width:r,height:o}},append:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.appendChild(o);return o},prepend:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.insertBefore(o,t.childNodes[0]);return o},after:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.parentNode.insertBefore(o,t.nextSibling);return o},before:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.parentNode.insertBefore(o,t);return o}};function l(){this.__el.innerHTML="";b.setStyles(this.__el,{"background-color":"#f7f7f7","user-select":"none"})}function c(e){if(this.__format==true){var t=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");var n=this.__contentArray[this.__tableIndex].content[+e.target.getAttribute("row")-1][+e.target.getAttribute("col")-1].style;for(var o=this.__region.info.row[0];o<=this.__region.info.row[1];o++){var r=b.find(t[o],function(){return true},"th");for(var i=this.__region.info.col[0];i<=this.__region.info.col[1];i++){for(var s in n){r[i].style[s]=n[s];this.__contentArray[this.__tableIndex].content[o-1][i-1].style[s]=n[s]}}}this.__format=false;b.removeClass(b.find(this.__menuQuickDom,function(e){return e.getAttribute("def-type")=="format"},"span")[0],"active")}this.$$moveCursorTo(e.target,+e.target.getAttribute("row"),+e.target.getAttribute("col"))}function p(e,t,n){var o=this;var r="";r+="<tr><th class='top-left' open-web-excel></th>";for(var i=0;i<e.content[0].length;i++){r+="<th class='top-name' open-web-excel>"+this.$$calcColName(i)+"</th>"}r+="</tr>";for(var s=0;s<e.content.length;s++){r+="<tr><th class='line-num' open-web-excel>"+(s+1)+"</th>";for(var a=0;a<e.content[s].length;a++){r+="<th\n                row='".concat(s+1,"'\n                col='").concat(a+1,'\'\n                contenteditable="true"\n                class="item"\n                colspan="').concat(e.content[s][a].colspan,'"\n                rowspan="').concat(e.content[s][a].rowspan,'"\n                style="').concat(n(e.content[s][a].style),'"\n            open-web-excel>').concat(e.content[s][a].value,"</th>")}r+="</tr>"}this.__contentDom[t]=b.append(this.__tableFrame,"<table style='display:none;' class='excel-view' open-web-excel>"+r+"</table>");var l=b.find(this.__contentDom[t],function(e){return b.hasClass(e,"item")},"th");b.bind(l,"click",function(e){o.$$itemClickHandler(e)})}var d=function e(t,n){for(var o=0;o<t.__contentDom.length;o++){if(o==n){b.setStyles(t.__contentDom[o],{display:"table"});t.__btnDom[o].setAttribute("active","yes")}else{b.setStyles(t.__contentDom[o],{display:"none"});t.__btnDom[o].setAttribute("active","no")}}t.__tableIndex=n;t.$$moveCursorTo(t.__contentDom[n].getElementsByTagName("tr")[1].getElementsByTagName("th")[1],1,1)};function u(){var o=this;this.__contentDom=[];this.__tableFrame=b.append(this.__el,"<div></div>");b.setStyles(this.__tableFrame,{width:"100%",height:"calc(100% - 92px)",overflow:"auto"});for(var e=0;e<this.__contentArray.length;e++){this.$$initTableView(this.__contentArray[e],e,this.$$styleToString);b.setStyles(this.__contentDom[e],{display:e==0?"table":"none"})}this.$$addStyle("excel-view","\n\n        .excel-view{\n            border-collapse: collapse;\n            width: 100%;\n        }\n\n        .excel-view .top-left{\n            border: 1px solid #d6cccb;\n            border-right:none;\n            background-color:white;\n        }\n\n        .excel-view .top-name{\n            border: 1px solid #d6cccb;\n            border-bottom:none;\n            color:gray;\n            font-size:12px;\n        }\n\n        .excel-view .line-num{\n            padding:0 5px;\n            border: 1px solid #d6cccb;\n            border-right:none;\n            color:gray;\n            font-size:12px;\n        }\n\n        .excel-view .item{\n            min-width:50px;\n            white-space: nowrap;\n            border:0.5px solid rgba(85,85,85,0.5);\n            outline:none;\n            font-size:12px;\n            padding:2px;\n        }\n\n        .excel-view .item[active='yes']{\n            outline: 2px dashed red;\n        }\n\n    ");var r=b.append(this.__el,"<div class='bottom-btn' open-web-excel></div>");var t=b.append(r,"<span class='add item' open-web-excel>+</span>");b.bind(t,"click",function(){o.__contentArray.push(o.$$formatContent()[0]);var e=o.__contentArray.length-1;o.$$initTableView(o.__contentArray[e],e,o.$$styleToString);var t=b.append(r,"<span class='name item' open-web-excel>"+o.__contentArray[e].name+"</span>");o.__btnDom.push(t);b.bind(t,"click",function(){d(o,e)})});this.__btnDom=[];var n=function e(t){var n=b.append(r,"<span class='name item' open-web-excel>"+o.__contentArray[t].name+"</span>");b.bind(n,"click",function(){d(o,t)});b.bind(n,"dblclick",function(){o.__btnDom[t].setAttribute("contenteditable","true")});b.bind(n,"blur",function(){o.__contentArray[t].name=n.innerText});o.__btnDom.push(n)};for(var i=0;i<this.__contentArray.length;i++){n(i)}this.$$addStyle("bottom-btn","\n\n        .bottom-btn{\n            width: 100%;\n            height: 30px;\n            overflow: auto;\n            border-top: 1px solid #d6cccb;\n            box-sizing: border-box;\n        }\n\n        .bottom-btn .item{\n            line-height: 30px;\n            box-sizing: border-box;\n            vertical-align: top;\n            display: inline-block;\n            cursor: pointer;\n        }\n\n        .bottom-btn .add{\n            width: 30px;\n            text-align: center;\n            font-size: 18px;\n        }\n\n        .bottom-btn .name{\n            font-size: 12px;\n            padding: 0 10px;\n        }\n        .bottom-btn .name:focus{\n            outline:none;\n        }\n\n        .bottom-btn .name:hover{\n            background-color:#efe9e9;\n        }\n\n        .bottom-btn .name[active='yes']{\n            background-color:white;\n        }\n\n    ");this.__btnDom[0].click()}function f(e){var t="";for(var n in e){t+=n+":"+e[n]+";"}return t}function _(){return{value:" ",colspan:"1",rowspan:"1",style:{display:"table-cell",color:"black",background:"white","vertical-align":"top","text-align":"left","font-weight":"normal","font-style":"normal","text-decoration":"none"}}}function h(e){if(e&&"version"in e&&e.filename=="Open-Web-Excel"){return e.contents}else{var t=[];for(var n=0;n<100;n++){var o=[];for(var r=0;r<30;r++){o.push(this.$$newItemData());o[r].value=n+1+"-"+(r+1)}t.push(o)}return[{name:"未命名",content:t}]}}function m(e){if(!i(e))return e;var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var n="";while(true){var o=e%26;n=t[o]+n;e=Math.floor(e/26);if(e==0)break;e-=1}return n}function v(e,t){var n=this.__contentArray[this.__tableIndex].content;for(var o=e;o>=1;o--){for(var r=t;r>=1;r--){if(n[o-1][r-1].style.display!="none"){if(n[o-1][r-1].rowspan- -o>e&&n[o-1][r-1].colspan- -r>t){return{row:o,col:r,content:n[o-1][r-1]}}else{break}}}}}var g=function e(t){var n="open-web-excel";t=t.replace(/( {0,}){/g,"{");t=t.replace(/( {0,}),/g,",");var o="";var r=false,i=false,s=false;for(var a=0;a<t.length;a++){if(t[a]==":"&&!r&&!s&&!i){s=true;o+="["+n+"]"}else if(t[a]=="{"&&!r){i=true;if(!s)o+="["+n+"]"}else if(t[a]=="}"&&!r){i=false;s=false}else if(t[a]=="/"&&t[a+1]=="*"){r=true}else if(t[a]=="*"&&t[a+1]=="/"){r=false}else if(t[a]==","&&!r&&!i){if(!s)o+="["+n+"]";s=false}o+=t[a]}return o};function w(){if("open-web-excel@style"in window);else{window["open-web-excel@style"]={}}var o=document.head||document.getElementsByTagName("head")[0];return function(e,t){if(window["open-web-excel@style"][e]);else{window["open-web-excel@style"][e]=true;var n=document.createElement("style");n.setAttribute("type","text/css");n.innerHTML=g("/*\n    Style[".concat(e,"] for Open-Web-Excel\n    https://www.npmjs.com/package/open-web-excel\n*/\n            ")+t);o.appendChild(n)}}}function y(e,t,n){if(this.__region!=null){this.$$cancelRegion();this.__region=null}if(this.__keyLog.shift){this.__region=this.$$calcRegionInfo({row:this.__rowNum,col:this.__colNum,rowNum:+this.__target.getAttribute("rowspan"),colNum:+this.__target.getAttribute("colspan")},{row:t,col:n,rowNum:+e.getAttribute("rowspan"),colNum:+e.getAttribute("colspan")});this.$$showRegion()}else{if(s(this.__target))this.__target.setAttribute("active","no");this.__rowNum=t;this.__colNum=n;this.__target=e;var o=this.__contentArray[this.__tableIndex].content[t-1][n-1];this.$$updateMenu(o.style);e.setAttribute("active","yes")}}function x(e,t){this.__contentArray[this.__tableIndex].content[this.__rowNum-1][this.__colNum-1].style[e]=t;this.__target.style[e]=t;this.$$updateMenu(this.__contentArray[this.__tableIndex].content[this.__rowNum-1][this.__colNum-1].style)}function $(e,t){var n={info:{},nodes:[]};var o=e.row;var r=e.row+e.rowNum-1;var i=t.row;var s=t.row+t.rowNum-1;var a=o>i?i:o;var l=r>s?r:s;var c=e.col;var p=e.col+e.colNum-1;var d=t.col;var u=t.col+t.colNum-1;var f=c>d?d:c;var _=p>u?p:u;n.info={row:[a,l],col:[f,_]};var h=this.__contentDom[this.__tableIndex].getElementsByTagName("tr");for(var b=a;b<=l;b++){var m=h[b].getElementsByTagName("th");for(var v=1;v<m.length;v++){var g=m[v].getAttribute("col");if(g>=f&&g<=_){n.nodes.push(m[v])}else{if(g>_){break}}}}return n}function A(){for(var e=0;e<this.__region.nodes.length;e++){this.__region.nodes[e].style.background="#e5e0e0"}}function N(){for(var e=0;e<this.__region.nodes.length;e++){this.__region.nodes[e].style.background=this.__contentArray[this.__tableIndex].content[this.__region.nodes[e].getAttribute("row")-1][this.__region.nodes[e].getAttribute("col")-1].style.background}}var k={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear",19:"pause",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",189:["-","_"],187:["=","+"],219:["[","{"],221:["]","}"],220:["\\","|"],186:[";",":"],222:["'",'"'],188:[",","<"],190:[".",">"],191:["/","?"],192:["`","~"]};var I=["shift","ctrl","alt"];function C(e){e=e||window.event;var t=e.keyCode||e.which;var n=k[t]||t;if(!n)return;if(n.constructor!==Array)n=[n,n];var o=n[0];var r=e.shiftKey?"shift+":"",i=e.altKey?"alt+":"",s=e.ctrlKey?"ctrl+":"";var a="",l=s+r+i;if(I.indexOf(n[0])>=0){n[0]=n[1]=""}var c=e.code=="Key"+e.key&&!r;a=l+(l==""&&c?n[1]:n[0]);if(n[0]==""){a=a.replace(/\+$/,"")}return a==""?o:a}function D(){var n=this;if("__keyLog"in this){console.error("Keyboard has been initialized");return}else{this.__keyLog={shift:false};b.bind(document.body,"keydown",function(e){var t=C(e);if(t=="shift")n.__keyLog.shift=true});b.bind(document.body,"keyup",function(e){var t=C(e);if(t=="shift")n.__keyLog.shift=false})}}var S=[["白","rgb(255, 255, 255)"],["漆黑","rgb(13, 0, 21)"],["红","rgb(254, 44, 35)"],["橙","rgb(255, 153, 0)"],["黄","rgb(255, 217, 0)"],["葱绿","rgb(163, 224, 67)"],["湖蓝","rgb(55, 217, 240)"],["天色","rgb(77, 168, 238)"],["藤紫","rgb(149, 111, 231)"],["白练","rgb(243, 243, 244)"],["白鼠","rgb(204, 204, 204)"],["樱","rgb(254, 242, 240)"],["镐","rgb(254, 245, 231)"],["练","rgb(254, 252, 217)"],["芽","rgb(237, 246, 232)"],["水","rgb(230, 250, 250)"],["缥","rgb(235, 244, 252)"],["丁香","rgb(240, 237, 246)"],["灰青","rgb(215, 216, 217)"],["鼠","rgb(165, 165, 165)"],["虹","rgb(251, 212, 208)"],["落柿","rgb(255, 215, 185)"],["花叶","rgb(249, 237, 166)"],["白绿","rgb(212, 233, 214)"],["天青","rgb(199, 230, 234)"],["天空","rgb(204, 224, 241)"],["水晶","rgb(218, 213, 233)"],["薄纯","rgb(123, 127, 131)"],["墨","rgb(73, 73, 73)"],["甚三红","rgb(238, 121, 118)"],["珊瑚","rgb(250, 165, 115)"],["金","rgb(230, 179, 34)"],["薄青","rgb(152, 192, 145)"],["白群","rgb(121, 198, 205)"],["薄花","rgb(110, 170, 215)"],["紫苑","rgb(156, 142, 193)"],["石墨","rgb(65, 70, 75)"],["黑","rgb(51, 51, 51)"],["绯红","rgb(190, 26, 29)"],["棕黄","rgb(185, 85, 20)"],["土黄","rgb(173, 114, 14)"],["苍翠","rgb(28, 114, 49)"],["孔雀","rgb(28, 120, 146)"],["琉璃","rgb(25, 67, 156)"],["青莲","rgb(81, 27, 120)"]];var T="<div class='color-view' open-web-excel>";for(var E=0;E<S.length;E++){T+="<div class='color-item' open-web-excel><span title='"+S[E][0]+"' open-web-excel style='background:"+S[E][1]+"'> </span></div>"}T+="</div>";var z=T;function L(){var f=this;var e=b.append(this.__el,"<div class='top-dom' open-web-excel></div>");this.$$addStyle("top-dom","\n\n       .top-dom{\n            width: 100%;\n            height: 62px;\n            overflow: hidden;\n       }\n\n    ");this.__menuDom=b.append(e,"<div class='menu' open-web-excel>\n        <span open-web-excel>\n            操作\n            <div open-web-excel>\n                <span class='item more' open-web-excel>\n                    插入\n                    <div open-web-excel>\n                        <span class='item' open-web-excel>\n                            <span def-type='insert-up'>向上插入</span>\n                            <input value='1' open-web-excel />\n                            <span def-type='insert-up'>行</span>\n                        </span>\n                        <span class='item' open-web-excel>\n                            <span def-type='insert-down'>向下插入</span>\n                            <input value='1' open-web-excel />\n                            <span def-type='insert-down'>行</span>\n                        </span>\n                        <span class='item' open-web-excel>\n                            <span def-type='insert-left'>向左插入</span>\n                            <input value='1' open-web-excel />\n                            <span def-type='insert-left'>列</span>\n                        </span>\n                        <span class='item' open-web-excel>\n                            <span def-type='insert-right'>向右插入</span>\n                            <input value='1' open-web-excel />\n                            <span def-type='insert-right'>列</span>\n                        </span>\n                    </div>\n                </span>\n                <span class='item more' open-web-excel>\n                    删除\n                    <div open-web-excel>\n                        <span class='item' open-web-excel def-type='delete-row'>\n                            删除当前行\n                        </span>\n                        <span class='item' open-web-excel def-type='delete-col'>\n                            删除当前列\n                        </span>\n                    </div>\n                </span>\n                <span class='item more' open-web-excel>\n                    合并单元格\n                    <div open-web-excel>\n                        <span class='item' def-type='merge-all' open-web-excel>全部合并</span>\n                        <span class='item' def-type='merge-cancel' open-web-excel>取消合并</span>\n                    </div>\n                </span>\n            </div>\n        </span>\n        <span open-web-excel>\n            格式\n            <div open-web-excel>\n                <span class='item' def-type='bold' open-web-excel>粗体</span>\n                <span class='item' def-type='italic' open-web-excel>斜体</span>\n                <span class='item' def-type='underline' open-web-excel>下划线</span>\n                <span class='item' def-type='line-through' open-web-excel>中划线</span>\n                <span class='line' open-web-excel></span>\n                <span class='item more' open-web-excel>\n                    水平对齐\n                    <div open-web-excel>\n                        <span class='item' def-type='horizontal-left' open-web-excel>左对齐</span>\n                        <span class='item' def-type='horizontal-center' open-web-excel>居中对齐</span>\n                        <span class='item' def-type='horizontal-right' open-web-excel>右对齐</span>\n                    </div>\n                </span>\n                <span class='item more' open-web-excel>\n                    垂直对齐\n                    <div open-web-excel>\n                        <span class='item' def-type='vertical-top' open-web-excel>顶部对齐</span>\n                        <span class='item' def-type='vertical-middle' open-web-excel>居中对齐</span>\n                        <span class='item' def-type='vertical-bottom' open-web-excel>底部对齐</span>\n                    </div>\n                </span>\n            </div>\n        </span>\n        <span open-web-excel>\n            帮助\n            <div open-web-excel>\n                <span class='item' open-web-excel>\n                    <a href='https://github.com/hai2007/Open-Web-Excel/issues' open-web-excel target='_blank'>问题反馈</a>\n                </span>\n            </div>\n        </span>\n    </div>");this.$$addStyle("menu",'\n\n        .menu{\n            border-bottom: 1px solid #d6cccb;\n            padding: 0 20px;\n            box-sizing: border-box;\n            white-space: nowrap;\n        }\n\n        .menu>span{\n            display: inline-block;\n            line-height: 26px;\n            padding: 0 10px;\n            font-size: 12px;\n            cursor: pointer;\n            color: #555555;\n        }\n        .menu>span:hover{\n            background: white;\n        }\n\n        .menu>span>div{\n            margin-left: -10px;\n        }\n\n        .menu>span div{\n            position:absolute;\n            background: white;\n            width: 140px;\n            box-shadow: 4px 3px 6px 0 #c9c9e2;\n            display:none;\n            padding:5px 0;\n        }\n\n        .menu>span div span{\n            display:block;\n            position:relative;\n            padding:5px 20px;\n        }\n\n        .menu>span div span>div{\n            left:140px;\n            top:0px;\n        }\n\n        .menu .line{\n            height:1px;\n            background-color:#d6cccb;\n            padding:0;\n            margin:0 10px;\n        }\n\n        .menu input{\n            width:20px;\n            outline:none;\n        }\n\n        .menu span:hover>div{\n            display:block;\n        }\n\n        .menu span.more:after{\n            content:">";\n            position: absolute;\n            right: 12px;\n            font-weight: 800;\n        }\n\n        .menu a{\n            text-decoration: none;\n            color: #555555;\n        }\n\n        .menu input{\n            width:20px;\n            outline:none;\n        }\n\n        .menu .item.active::before{\n            content: "*";\n            color: red;\n            position: absolute;\n            left: 8px;\n        }\n\n        .menu .item{\n            text-decoration: none;\n        }\n\n        .menu .item:hover{\n            text-decoration: underline;\n        }\n\n    ');this.__menuQuickDom=b.append(e,"<div class='quick-menu' open-web-excel>\n        <span class='item' def-type='format' open-web-excel>格式化</span>\n        <span class='line' open-web-excel></span>\n        <span class='item color' def-type='font-color' open-web-excel>\n            文字颜色：<i class='color' open-web-excel></i>\n            ".concat(z,"\n        </span>\n        <span class='item color' def-type='background-color' open-web-excel>\n            填充色：<i class='color' open-web-excel></i>\n            ").concat(z,"\n        </span>\n        <span class='line' open-web-excel></span>\n        <span class='item' def-type='merge-all' open-web-excel>\n            全部合并\n        </span>\n        <span class='item' def-type='merge-cancel' open-web-excel>\n            取消合并\n        </span>\n        <span class='line' open-web-excel></span>\n        <span class='item' def-type='horizontal-left' open-web-excel>\n            左对齐\n        </span>\n        <span class='item' def-type='horizontal-center' open-web-excel>\n            居中对齐\n        </span>\n        <span class='item' def-type='horizontal-right' open-web-excel>\n            右对齐\n        </span>\n        <span class='line' open-web-excel></span>\n        <span class='item' def-type='vertical-top' open-web-excel>\n            顶部对齐\n        </span>\n        <span class='item' def-type='vertical-middle' open-web-excel>\n            居中对齐\n        </span>\n        <span class='item' def-type='vertical-bottom' open-web-excel>\n            底部对齐\n        </span>\n    </div>"));this.$$addStyle("quick-menu","\n\n        .quick-menu{\n            line-height: 36px;\n            font-size: 12px;\n            white-space: nowrap;\n            width: 100%;\n            overflow: auto;\n        }\n\n        .quick-menu span{\n            display:inline-block;\n            vertical-align: top;\n        }\n\n        .quick-menu span>i.color{\n            display: inline-block;\n            height: 14px;\n            width: 20px;\n            border:1px solid #d6cccb;\n            vertical-align: middle;\n        }\n\n        .quick-menu .item{\n            margin:0 10px;\n            cursor: pointer;\n        }\n\n        .quick-menu .line{\n            background-color:#d6cccb;\n            width:1px;\n            height:22px;\n            margin-top:7px;\n        }\n\n        .quick-menu .item:hover{\n            font-weight: 800;\n        }\n\n        .quick-menu .item.active{\n            font-weight: 800;\n            color: red;\n        }\n\n        /* 选择颜色 */\n\n        .color-view{\n            font-size: 0px;\n            width: 171px;\n            position: absolute;\n            padding: 10px;\n            box-sizing: content-box;\n            background: #fefefe;\n            box-shadow: 1px 1px 5px #9e9695;\n            line-height:1em;\n            display:none;\n            margin-top: -5px;\n            white-space: normal;\n        }\n\n        .color:hover>.color-view, .color-view:hover{\n            display:block;\n        }\n\n        .color-item{\n            display: inline-block;\n            width: 19px;\n            height: 19px;\n        }\n\n        .color-item>span{\n            width: 15px;\n            height: 15px;\n            margin: 2px;\n            cursor: pointer;\n            box-sizing: border-box;\n        }\n\n        .color-item>span:hover{\n            outline:1px solid black;\n        }\n\n    ");var t=b.find(e,function(e){return e.getAttribute("def-type")},"span");b.bind(t,"click",function(e){var t=e.target;var n=t.getAttribute("def-type");if(n=="format"){if(f.__region!=null){f.__format=true;b.addClass(b.find(f.__menuQuickDom,function(e){return e.getAttribute("def-type")=="format"},"span")[0],"active")}}else if(n=="bold"){f.$$setItemStyle("font-weight",b.hasClass(t,"active")?"normal":"bold")}else if(n=="italic"){f.$$setItemStyle("font-style",b.hasClass(t,"active")?"normal":"italic")}else if(n=="line-through"){f.$$setItemStyle("text-decoration",b.hasClass(t,"active")?"none":"line-through")}else if(n=="underline"){f.$$setItemStyle("text-decoration",b.hasClass(t,"active")?"none":"underline")}else if(/^horizontal\-/.test(n)){f.$$setItemStyle("text-align",n.replace("horizontal-",""))}else if(/^vertical\-/.test(n)){f.$$setItemStyle("vertical-align",n.replace("vertical-",""))}else if(/^merge\-/.test(n)){if(f.__region==null)return;if(n=="merge-all"){if(f.__region.nodes.length<=1)return;for(var o=1;o<f.__region.nodes.length;o++){f.__contentArray[f.__tableIndex].content[f.__region.nodes[o].getAttribute("row")-1][f.__region.nodes[o].getAttribute("col")-1].style.display="none";f.__contentArray[f.__tableIndex].content[f.__region.nodes[o].getAttribute("row")-1][f.__region.nodes[o].getAttribute("col")-1].value=" ";f.__region.nodes[o].style.display="none"}f.__region.nodes=[f.__region.nodes[0]];f.__contentArray[f.__tableIndex].content[f.__region.nodes[0].getAttribute("row")-1][f.__region.nodes[0].getAttribute("col")-1].colspan=f.__region.info.col[1]-f.__region.info.col[0]+1+"";f.__contentArray[f.__tableIndex].content[f.__region.nodes[0].getAttribute("row")-1][f.__region.nodes[0].getAttribute("col")-1].rowspan=f.__region.info.row[1]-f.__region.info.row[0]+1+"";f.__region.nodes[0].setAttribute("colspan",f.__region.info.col[1]-f.__region.info.col[0]+1+"");f.__region.nodes[0].setAttribute("rowspan",f.__region.info.row[1]-f.__region.info.row[0]+1+"");f.__region.nodes[0].click()}else if(n=="merge-cancel"){var r=b.find(f.__contentDom[f.__tableIndex],function(){return true},"tr");for(var i=f.__region.info.row[0];i<=f.__region.info.row[1];i++){var s=b.find(r[i],function(){return true},"th");for(var a=f.__region.info.col[0];a<=f.__region.info.col[1];a++){s[a].style.display="table-cell";s[a].setAttribute("colspan","1");s[a].setAttribute("rowspan","1");f.__contentArray[f.__tableIndex].content[i-1][a-1].style.display="table-cell";f.__contentArray[f.__tableIndex].content[i-1][a-1].colspan="1";f.__contentArray[f.__tableIndex].content[i-1][a-1].rowspan="1"}}f.$$cancelRegion();f.__region=null}}else if(/^insert\-/.test(n)){var l=+b.find(t.parentNode,function(){return true},"input")[0].value;if(n=="insert-up"){for(var c=0;c<l;c++){f.$$insertUpNewRow()}}else if(n=="insert-down"){for(var p=0;p<l;p++){f.$$insertDownNewRow()}}else if(n=="insert-left"){for(var d=0;d<l;d++){f.$$insertLeftNewCol()}}else if(n=="insert-right"){for(var u=0;u<l;u++){f.$$insertRightNewCol()}}}else if(/^delete\-/.test(n)){if(n=="delete-row"){f.$$deleteCurrentRow()}else if(n=="delete-col"){f.$$deleteCurrentCol()}}});var r=b.find(e,function(e){return b.hasClass(e,"color")},"span");var n=function e(o){var t=b.find(r[o],function(){return true},"span");b.bind(t,"click",function(e){var t=r[o].getAttribute("def-type");var n=e.target.style.background;f.$$setItemStyle({"background-color":"background","font-color":"color"}[t],n)})};for(var o=0;o<r.length;o++){n(o)}}function O(e){var t=b.find(this.__menuDom,function(e){return e.getAttribute("def-type")},"span");for(var n=0;n<t.length;n++){var o=t[n].getAttribute("def-type");if(o=="bold"){if(e["font-weight"]=="bold"){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}else if(o=="italic"){if(e["font-style"]=="italic"){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}else if(o=="underline"){if(e["text-decoration"]=="underline"){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}else if(o=="line-through"){if(e["text-decoration"]=="line-through"){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}else if(/^horizontal\-/.test(o)){if(o=="horizontal-"+e["text-align"]){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}else if(/^vertical\-/.test(o)){if(o=="vertical-"+e["vertical-align"]){b.addClass(t[n],"active")}else{b.removeClass(t[n],"active")}}}var r=b.find(this.__menuQuickDom,function(e){return e.getAttribute("def-type")},"span");for(var i=0;i<r.length;i++){var s=r[i].getAttribute("def-type");if(s=="font-color"){r[i].getElementsByTagName("i")[0].style.backgroundColor=e.color}else if(s=="background-color"){r[i].getElementsByTagName("i")[0].style.backgroundColor=e.background}else if(/^horizontal\-/.test(s)){if(s=="horizontal-"+e["text-align"]){b.addClass(r[i],"active")}else{b.removeClass(r[i],"active")}}else if(/^vertical\-/.test(s)){if(s=="vertical-"+e["vertical-align"]){b.addClass(r[i],"active")}else{b.removeClass(r[i],"active")}}}}function j(){var t=this;var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");var n=b.before(e[this.__rowNum],'<tr><th class="line-num" open-web-excel>'+this.__rowNum+"</th></tr>");e.splice(this.__rowNum,0,n);this.__contentArray[this.__tableIndex].content.splice(this.__rowNum-1,0,[]);for(var o=this.__rowNum+1;o<=e.length-1;o++){var r=b.find(e[o],function(){return true},"th");r[0].innerText=o;for(var i=1;i<r.length;i++){r[i].setAttribute("row",o)}}for(var s=1;s<=this.__contentArray[this.__tableIndex].content[this.__rowNum==1?1:0].length;s++){var a=this.$$newItemData();var l=this.__contentArray[this.__tableIndex].content[this.__rowNum][s-1];if(this.__rowNum!=1&&l.style.display=="none"){var c=false;for(var p=s-1;p>=1;p--){var d=this.__contentArray[this.__tableIndex].content[this.__rowNum][p-1];if(d.style.display!="none"){if(p- -d.colspan>s)c=true;break}}if(!c){a.style.display="none";var u=s==1||this.__contentArray[this.__tableIndex].content[this.__rowNum][s-2].style.display!="none";if(u){for(var f=this.__rowNum-1;f>0;f--){if(this.__contentArray[this.__tableIndex].content[f-1][s-1].style.display!="none"){this.__contentArray[this.__tableIndex].content[f-1][s-1].rowspan-=-1;var _=b.find(e[f],function(){return true},"th")[s];_.setAttribute("rowspan",_.getAttribute("rowspan")- -1);break}}}}}this.__contentArray[this.__tableIndex].content[this.__rowNum-1].push(a);var h=b.append(n,'<th row="'.concat(this.__rowNum,'" col="').concat(s,'" contenteditable="true" class="item" colspan="1" rowspan="1" style="').concat(this.$$styleToString(a.style),'" open-web-excel></th>'));b.bind(h,"click",function(e){t.$$itemClickHandler(e)})}this.__rowNum+=1}function H(){var t=this;var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");var n=b.after(e[this.__rowNum],'<tr><th class="line-num" open-web-excel>'+(this.__rowNum+1)+"</th></tr>");e.splice(this.__rowNum+1,0,n);this.__contentArray[this.__tableIndex].content.splice(this.__rowNum,0,[]);for(var o=this.__rowNum+2;o<=e.length-1;o++){var r=b.find(e[o],function(){return true},"th");r[0].innerText=o;for(var i=1;i<r.length;i++){r[i].setAttribute("row",o)}}for(var s=1;s<=this.__contentArray[this.__tableIndex].content[0].length;s++){var a=this.$$newItemData();if(this.__rowNum!=this.__contentArray[this.__tableIndex].content.length-1){var l=this.__contentArray[this.__tableIndex].content[this.__rowNum-1][s-1];if(l.style.display=="none"||l.rowspan!="1"){var c=this.$$getLeftTop(this.__rowNum,s);if(c.row- -c.content.rowspan-1>this.__rowNum){a.style.display="none";if(c.col==s){this.__contentArray[this.__tableIndex].content[c.row-1][c.col-1].rowspan-=-1;var p=b.find(e[c.row],function(){return true},"th")[c.col];p.setAttribute("rowspan",p.getAttribute("rowspan")- -1)}}}}this.__contentArray[this.__tableIndex].content[this.__rowNum].push(a);var d=b.append(n,'<th row="'.concat(this.__rowNum,'" col="').concat(s,'" contenteditable="true" class="item" colspan="1" rowspan="1" style="').concat(this.$$styleToString(a.style),'" open-web-excel></th>'));b.bind(d,"click",function(e){t.$$itemClickHandler(e)})}}function R(){var t=this;var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");b.append(e[0],"<th class='top-name' open-web-excel>"+this.$$calcColName(this.__contentArray[this.__tableIndex].content[0].length)+"</th>");for(var n=1;n<e.length;n++){var o=b.find(e[n],function(){return true},"th");for(var r=this.__colNum;r<o.length;r++){o[r].setAttribute("col",r+1)}var i=this.$$newItemData();var s=this.__contentArray[this.__tableIndex].content[n-1][this.__colNum-1];if(this.__colNum!=1&&s.style.display=="none"){var a=false;for(var l=n-1;l>=1;l--){var c=this.__contentArray[this.__tableIndex].content[l-1][this.__colNum];if(c.style.display!="none"){if(l- -c.rowspan>n)a=true;break}}if(!a){i.style.display="none";var p=n==1||this.__contentArray[this.__tableIndex].content[n-2][this.__colNum].style.display!="none";if(p){for(var d=this.__colNum-1;d>0;d--){if(this.__contentArray[this.__tableIndex].content[n-1][d-1].style.display!="none"){this.__contentArray[this.__tableIndex].content[n-1][d-1].colspan-=-1;var u=b.find(e[n],function(){return true},"th")[d];u.setAttribute("colspan",u.getAttribute("colspan")- -1);break}}}}}this.__contentArray[this.__tableIndex].content[n-1].splice(this.__colNum-1,0,i);var f=b.before(o[this.__colNum],'<th row="'.concat(n,'" col="').concat(this.__colNum,'" contenteditable="true" class="item" colspan="1" rowspan="1" style="').concat(this.$$styleToString(i.style),'" open-web-excel></th>'));b.bind(f,"click",function(e){t.$$itemClickHandler(e)})}this.__colNum+=1}function B(){var t=this;var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");b.append(e[0],"<th class='top-name' open-web-excel>"+this.$$calcColName(this.__contentArray[this.__tableIndex].content[0].length)+"</th>");for(var n=1;n<e.length;n++){var o=b.find(e[n],function(){return true},"th");for(var r=this.__colNum+1;r<o.length;r++){o[r].setAttribute("col",r+1)}var i=this.$$newItemData();if(this.__colNum!=this.__contentArray[this.__tableIndex].content[0].length-1){var s=this.__contentArray[this.__tableIndex].content[n-1][this.__colNum-1];if(s.style.display=="none"||s.colspan!="1"){var a=this.$$getLeftTop(n,this.__colNum);if(a.col- -a.content.colspan-1>this.__colNum){i.style.display="none";if(a.row==n){this.__contentArray[this.__tableIndex].content[a.row-1][a.col-1].colspan-=-1;var l=b.find(e[a.row],function(){return true},"th")[a.col];l.setAttribute("colspan",l.getAttribute("colspan")- -1)}}}}this.__contentArray[this.__tableIndex].content[n-1].splice(this.__colNum,0,i);var c=b.after(o[this.__colNum],'<th row="'.concat(n,'" col="').concat(this.__colNum+1,'" contenteditable="true" class="item" colspan="1" rowspan="1" style="').concat(this.$$styleToString(i.style),'" open-web-excel></th>'));b.bind(c,"click",function(e){t.$$itemClickHandler(e)})}}function M(){var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");for(var t=this.__rowNum+1;t<=this.__contentArray[this.__tableIndex].content.length;t++){var n=b.find(e[t],function(){return true},"th");n[0].innerText=t-1;for(var o=1;o<n.length;o++){n[o].setAttribute("row",t-1)}}e[this.__rowNum].remove();this.__contentArray[this.__tableIndex].content.splice(this.__rowNum-1,1);this.__btnDom[this.__tableIndex].click()}function P(){var e=b.find(this.__contentDom[this.__tableIndex],function(){return true},"tr");b.find(e[0],function(){return true},"th")[this.__contentArray[this.__tableIndex].content[0].length].remove();for(var t=1;t<e.length;t++){var n=b.find(e[t],function(){return true},"th");for(var o=this.__colNum+1;o<n.length;o++){n[o].setAttribute("col",o-1)}n[this.__colNum].remove();this.__contentArray[this.__tableIndex].content[t-1].splice(this.__colNum-1,1)}this.__btnDom[this.__tableIndex].click()}var W=function e(t){var n=this;if(!(this instanceof e)){throw new Error("Open-Web-Excel is a constructor and should be called with the `new` keyword")}if(s(t.el)){this.__el=t.el;this.__contentArray=this.$$formatContent(t.content);this.__region=null;this.__format=false}else{throw new Error("options.el is not a element!")}this.$$renderKeyboard();this.$$initDom();this.$$createdMenu();this.$$initView();this.valueOf=function(){return{version:"v1",filename:"Open-Web-Excel",contents:n.__contentArray}}};W.prototype.$$formatContent=h;W.prototype.$$calcColName=m;W.prototype.$$addStyle=w();W.prototype.$$styleToString=f;W.prototype.$$newItemData=_;W.prototype.$$itemClickHandler=c;W.prototype.$$getLeftTop=v;W.prototype.$$initDom=l;W.prototype.$$initView=u;W.prototype.$$initTableView=p;W.prototype.$$createdMenu=L;W.prototype.$$updateMenu=O;W.prototype.$$moveCursorTo=y;W.prototype.$$setItemStyle=x;W.prototype.$$calcRegionInfo=$;W.prototype.$$showRegion=A;W.prototype.$$cancelRegion=N;W.prototype.$$insertUpNewRow=j;W.prototype.$$insertDownNewRow=H;W.prototype.$$insertLeftNewCol=R;W.prototype.$$insertRightNewCol=B;W.prototype.$$deleteCurrentRow=M;W.prototype.$$deleteCurrentCol=P;W.prototype.$$renderKeyboard=D;if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=W}else{window.OpenWebExcel=W}})();