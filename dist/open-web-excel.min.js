/*!
* Open Web Excel - ✍️ An Excel Used on the Browser Side.
* git+https://github.com/hai2007/Open-Web-Excel.git
*
* author 你好2007
*
* version 0.1.0-alpha.0
*
* Copyright (c) 2021 hai2007 走一步，再走一步。
* Released under the MIT license
*
* Date:Tue Apr 20 2021 12:17:53 GMT+0800 (GMT+08:00)
*/

"use strict";function _typeof(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function e(t){return typeof t}}else{_typeof=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof(e)}(function(){"use strict";var t=Object.prototype.toString;function n(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function o(e){if(e===null||_typeof(e)!=="object"||n(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}var r=function e(t,n){return n!==null&&_typeof(n)==="object"&&t.indexOf(n.nodeType)>-1&&!o(n)};var i=function e(t){return r([1,9,11],t)};var l={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var a={stopPropagation:function e(t){t=t||window.event;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},preventDefault:function e(t){t=t||window.event;if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},isNode:function e(t){return t&&(t.nodeType===1||t.nodeType===9||t.nodeType===11)},bind:function e(t,n,o){if(t.constructor===Array||t.constructor===NodeList||t.constructor===HTMLCollection){for(var r=0;r<t.length;r++){this.bind(t[r],n,o)}return}if(window.attachEvent)t.attachEvent("on"+n,o);else t.addEventListener(n,o,false)},unbind:function e(t,n,o){if(t.constructor===Array||t.constructor===NodeList||t.constructor===HTMLCollection){for(var r=0;r<t.length;r++){this.unbind(t[r],n,o)}return}if(window.detachEvent)t.detachEvent("on"+n,o);else t.removeEventListener(n,o,false)},find:function e(t,n,o){if(!this.isNode(t))return[];var r=t.getElementsByTagName(o||"*");var i=[];for(var l=0;l<r.length;l++){if(this.isNode(r[l])&&(typeof n!="function"||n(r[l])))i.push(r[l])}return i},children:function e(t,n){var o=t.childNodes;var r=[];for(var i=0;i<o.length;i++){if(this.isNode(o[i])&&(typeof n!="function"||n(o[i])))r.push(o[i])}return r},hasClass:function e(t,n,o){if(n.constructor!==Array)n=[n];var r=" "+(t.getAttribute("class")||"")+" ";for(var i=0;i<n.length;i++){if(r.indexOf(" "+n[i]+" ")>=0){if(o)return true}else{if(!o)return false}}return true},removeClass:function e(t,n){var o=" "+(t.getAttribute("class")||"")+" ";var r=o.replace(" "+n.trim()+" "," ");t.setAttribute("class",r.trim())},addClass:function e(t,n){if(this.hasClass(t,n))return;var o=t.getAttribute("class")||"";t.setAttribute("class",o+" "+n)},toNode:function e(t,n){var o;if(n)o=document.createElementNS(l.svg,"svg");else o=document.createElement("div");o.innerHTML=t;var r=o.childNodes;for(var i=0;i<r.length;i++){if(this.isNode(r[i]))return r[i]}},trigger:function e(t,n){if(document.createEventObject){t.fireEvent("on"+n,document.createEventObject())}else{var o=document.createEvent("HTMLEvents");o.initEvent(n,true,false);t.dispatchEvent(o)}},getStyle:function e(t,n){var o=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle;return typeof n==="string"?o.getPropertyValue(n):o},offsetPosition:function e(t){var n=0;var o=0;o=t.offsetTop;n=t.offsetLeft;t=t.offsetParent;while(t){o+=t.offsetTop;n+=t.offsetLeft;t=t.offsetParent}return{left:n,top:o}},mousePosition:function e(t,n){var o=t.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");return{x:n.clientX-o.left,y:n.clientY-o.top}},remove:function e(t){t.parentNode.removeChild(t)},setStyles:function e(t,n){for(var o in n){t.style[o]=n[o]}},size:function e(t,n){var o,r;if(n=="content"){r=t.clientWidth-(this.getStyle(t,"padding-left")+"").replace("px","")-(this.getStyle(t,"padding-right")+"").replace("px","");o=t.clientHeight-(this.getStyle(t,"padding-top")+"").replace("px","")-(this.getStyle(t,"padding-bottom")+"").replace("px","")}else if(n=="padding"){r=t.clientWidth;o=t.clientHeight}else if(n=="border"){r=t.offsetWidth;o=t.offsetHeight}else if(n=="scroll"){r=t.scrollWidth;o=t.scrollHeight}else{r=t.offsetWidth;o=t.offsetHeight}return{width:r,height:o}},append:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.appendChild(o);return o},prepend:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.insertBefore(o,t.childNodes[0]);return o},after:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.parentNode.insertBefore(o,t.nextSibling);return o},before:function e(t,n){var o=this.isNode(n)?n:this.toNode(n);t.parentNode.insertBefore(o,t);return o}};function e(){this._el.innerHTML="";a.setStyles(this._el,{"background-color":"#f7f7f7","user-select":"none"})}function s(e,t){var n="";n+="<tr><th class='top-left' open-web-excel></th>";for(var o=0;o<e.content[0].length;o++){n+="<th class='top-name' open-web-excel>"+this.$$calcColName(o)+"</th>"}n+="</tr>";for(var r=0;r<e.content.length;r++){n+="<tr><th class='line-num' open-web-excel>"+(r+1)+"</th>";for(var i=0;i<e.content[r].length;i++){if(e.content[r][i]!="null"){n+='<th contenteditable="true" class="item" colspan="'+e.content[r][i].colspan+'"  rowspan="'+e.content[r][i].rowspan+'" open-web-excel>'+e.content[r][i].value+"</th>"}}n+="</tr>"}this._contentDom[t]=a.append(this._tableFrame,"<table style='display:none;' class='excel-view' open-web-excel>"+n+"</table>")}var c=function e(t,n,o){for(var r=0;r<n.length;r++){if(r==o){a.setStyles(n[r],{display:"table"});t[r].setAttribute("active","yes")}else{a.setStyles(n[r],{display:"none"});t[r].setAttribute("active","no")}}};function f(){var o=this;this._contentDom=[];this._tableFrame=a.append(this._el,"<div></div>");a.setStyles(this._tableFrame,{width:"100%",height:"calc(100% - 92px)",overflow:"auto"});for(var e=0;e<this._contentArray.length;e++){this.$$initTableView(this._contentArray[e],e);a.setStyles(this._contentDom[e],{display:e==0?"table":"none"})}this.$$addStyle("excel-view","\n\n        .excel-view{\n            border-collapse: collapse;\n            width: 100%;\n        }\n\n        .excel-view .top-left{\n            width:50px;\n            border: 1px solid #d6cccb;\n            border-right:none;\n            background-color:white;\n        }\n\n        .excel-view .top-name{\n            border: 1px solid #d6cccb;\n            border-bottom:none;\n            color:gray;\n        }\n\n        .excel-view .line-num{\n            width:50px;border: 1px solid #d6cccb;border-right:none;color:gray;\n        }\n\n        .excel-view .item{\n            vertical-align:top;\n            min-width:50px;\n            padding:5px;\n            white-space: nowrap;\n            outline:0.5px solid #555555;\n            background-color:white;\n        }\n\n    ");var r=a.append(this._el,"<div class='bottom-btn' open-web-excel></div>");var t=a.append(r,"<span class='add item' open-web-excel>+</span>");a.bind(t,"click",function(){o._contentArray.push(o.$$formatContent()[0]);var e=o._contentArray.length-1;o.$$initTableView(o._contentArray[e],e);var t=a.append(r,"<span class='name item' open-web-excel>"+o._contentArray[e].name+"</span>");o._btnDom.push(t);a.bind(t,"click",function(){c(o._btnDom,o._contentDom,e)})});this._btnDom=[];var n=function e(t){var n=a.append(r,"<span class='name item' open-web-excel>"+o._contentArray[t].name+"</span>");a.bind(n,"click",function(){c(o._btnDom,o._contentDom,t)});a.bind(n,"dblclick",function(){o._btnDom[t].setAttribute("contenteditable","true")});a.bind(n,"blur",function(){o._contentArray[t].name=n.innerText});o._btnDom.push(n)};for(var i=0;i<this._contentArray.length;i++){n(i)}this.$$addStyle("bottom-btn","\n\n        .bottom-btn{\n            width: 100%;\n            height: 30px;\n            overflow: auto;\n            border-top: 1px solid #d6cccb;\n            box-sizing: border-box;\n        }\n\n        .bottom-btn .item{\n            line-height: 30px;\n            box-sizing: border-box;\n            vertical-align: top;\n            display: inline-block;\n            cursor: pointer;\n        }\n\n        .bottom-btn .add{\n            width: 30px;\n            text-align: center;\n            font-size: 18px;\n        }\n\n        .bottom-btn .name{\n            font-size: 12px;\n            padding: 0 10px;\n        }\n        .bottom-btn .name:focus{\n            outline:none;\n        }\n\n        .bottom-btn .name:hover{\n            background-color:#efe9e9;\n        }\n\n        .bottom-btn .name[active='yes']{\n            background-color:white;\n        }\n\n    ");this._btnDom[0].click()}function d(e){if(e&&"version"in e&&e.filename=="Open-Web-Excel"){return e.contents}else{var t=[];for(var n=0;n<100;n++){var o=[];for(var r=0;r<30;r++){o.push({value:"",colspan:"1",rowspan:"1"})}t.push(o)}return[{name:"未命名",content:t}]}}function p(e){var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var n="";while(true){var o=e%26;n=t[o]+n;e=Math.floor(e/26);if(e==0)break;e-=1}return n}var u=function e(t){var n="open-web-excel";t=t.replace(/( {0,}){/g,"{");t=t.replace(/( {0,}),/g,",");var o="";var r=false,i=false,l=false;for(var a=0;a<t.length;a++){if(t[a]==":"&&!r&&!l&&!i){l=true;o+="["+n+"]"}else if(t[a]=="{"&&!r){i=true;if(!l)o+="["+n+"]"}else if(t[a]=="}"&&!r){i=false;l=false}else if(t[a]=="/"&&t[a+1]=="*"){r=true}else if(t[a]=="*"&&t[a+1]=="/"){r=false}else if(t[a]==","&&!r&&!i){if(!l)o+="["+n+"]";l=false}o+=t[a]}return o};function h(){if("open-web-excel@style"in window);else{window["open-web-excel@style"]={}}var o=document.head||document.getElementsByTagName("head")[0];return function(e,t){if(window["open-web-excel@style"][e]);else{window["open-web-excel@style"][e]=true;var n=document.createElement("style");n.setAttribute("type","text/css");n.innerHTML=u(t);o.appendChild(n)}}}var b={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear",19:"pause",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",189:["-","_"],187:["=","+"],219:["[","{"],221:["]","}"],220:["\\","|"],186:[";",":"],222:["'",'"'],188:[",","<"],190:[".",">"],191:["/","?"],192:["`","~"]};var v=["shift","ctrl","alt"];function m(e){e=e||window.event;var t=e.keyCode||e.which;var n=b[t]||t;if(!n)return;if(n.constructor!==Array)n=[n,n];var o=e.shiftKey?"shift+":"",r=e.altKey?"alt+":"",i=e.ctrlKey?"ctrl+":"";var l="",a=i+o+r;if(v.indexOf(n[0])>=0){n[0]=n[1]=""}var s=e.code=="Key"+e.key&&!o;l=a+(a==""&&s?n[1]:n[0]);if(n[0]==""){l=l.replace(/\+$/,"")}return l}function y(){var n=this;if("_keyLog"in this){console.error("Keyboard has been initialized");return}else{this._keyLog={shift:false};a.bind(document.body,"keydown",function(e){var t=m(e);if(t=="shift")n._keyLog.shift=true});a.bind(document.body,"keyup",function(e){var t=m(e);if(t=="shift")n._keyLog.shift=false})}}function w(){var e=a.append(this._el,"<div class='top-dom' open-web-excel></div>");this.$$addStyle("top-dom","\n\n       .top-dom{\n            width: 100%;\n            height: 62px;\n            overflow: auto;\n       }\n\n    ");this._menuDom=a.append(e,"<div class='menu' open-web-excel>\n        <span open-web-excel>\n            格式\n        </span>\n        <span open-web-excel>帮助</span>\n    </div>");this.$$addStyle("menu","\n\n        .menu{\n            border-bottom: 1px solid #d6cccb;\n            padding: 0 20px;\n            box-sizing: border-box;\n        }\n\n        .menu>span{\n            display: inline-block;\n            line-height: 26px;\n            padding: 0 10px;\n            font-size: 12px;\n            cursor: pointer;\n            color: #555555;\n        }\n\n    ")}var g=function e(t){var n=this;if(!(this instanceof e)){throw new Error("Open-Web-Excel is a constructor and should be called with the `new` keyword")}if(i(t.el)){this._el=t.el;this._contentArray=this.$$formatContent(t.content)}else{throw new Error("options.el is not a element!")}this.$$initDom();this.$$createdMenu();this.$$initView();this.valueOf=function(){return{version:"0.1.0",filename:"Open-Web-Excel",contents:n._contentArray}};this.$$renderKeyboard()};g.prototype.$$formatContent=d;g.prototype.$$calcColName=p;g.prototype.$$addStyle=h();g.prototype.$$initDom=e;g.prototype.$$initView=f;g.prototype.$$initTableView=s;g.prototype.$$createdMenu=w;g.prototype.$$renderKeyboard=y;if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=g}else{window.OpenWebExcel=g}})();